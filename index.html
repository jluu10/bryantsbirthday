<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>yorknew city birthday route</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    :root{
      --sky:#aee3ff; --sky-2:#86d7ff; --sand:#f5e9d2;
      --ink:#111827; --muted:#6b7280; --card:#fffdf8; --accent:#4aa3ff; --accent-2:#ffbf7f;
      --ring:rgba(74,163,255,.45); --shadow:rgba(0,0,0,.12);
      --chibi-size:84px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:linear-gradient(180deg,var(--sky) 0%,var(--sky-2) 50%,var(--sand) 100%); color:var(--ink); font-family:'Press Start 2P', ui-monospace, Menlo, Consolas, monospace}

    header.hero{ text-align:center; padding:1.25rem .8rem .4rem }
    header.hero h1{ margin:.2rem 0; font-size:clamp(1.1rem,2.6vw,1.6rem) }
    header.hero .sub{ color:#233; opacity:.9; font-size:.8rem }

    .scene{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; padding:1rem; z-index:30 }
    .scene.active{ display:flex }
    .modal{ width:min(740px,100%); background:var(--card); border:4px solid #e8dcc6; border-radius:12px; padding:1rem; box-shadow:0 20px 60px var(--shadow); text-align:center }
    .row{ display:flex; flex-wrap:wrap; gap:.6rem; margin-top:.6rem; justify-content:center }
    .btn{ background:var(--accent); color:#fff; border:none; padding:.75rem 1rem; border-radius:10px; box-shadow:0 6px 0 #2b79c5; cursor:pointer }
    .btn.secondary{ background:#ffe7c9; color:#50381d; box-shadow:0 6px 0 #d7b38a }
    .btn:focus{ outline:2px solid var(--ring); outline-offset:2px }

    /* narrator */
    .narrator-layer{ position:fixed; inset:0; z-index:28; display:none }
    .narrator-layer.show{ display:block }
    .speech{ position:relative; margin:0 auto; background:var(--card); border:4px solid #e8dcc6; border-radius:12px; padding:1.5rem 1.1rem 1rem; width:min(780px,92vw); box-shadow:0 20px 60px var(--shadow); text-align:left; }
    .speech .txt{ line-height:1.6; font-size:.8rem }
    .speech .who{ display:block; color:#7c6b55; font-size:.7rem; margin-bottom:.25rem }

    /* chibi ABOVE dialog box */
    .chibi-head{
      --size:var(--chibi-size);
      position:fixed; 
      left:50%; 
      top: calc(50% - var(--chibi-size) - 140px); /* hover above speech */
      transform:translateX(-50%);
      width:var(--size); height:var(--size);
      user-select:none; touch-action:none;
      filter: drop-shadow(0 10px 16px rgba(0,0,0,.25));
      animation:bob 2.1s ease-in-out infinite;
      z-index:50; /* on top of everything */
    }
    .chibi-head img{ width:100%; height:auto; display:block; object-fit:contain; image-rendering:pixelated; }
    .chibi-head.wave img{ animation:wave 900ms ease-in-out 1; }

    @keyframes bob{0%,100%{transform:translate(-50%,0)}50%{transform:translate(-50%,-6px)}}
    @keyframes wave{0%{ rotate:0 }25%{ rotate:-6deg }60%{ rotate:4deg }100%{ rotate:0 }}

    #tapHint{ position:fixed; bottom:18px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,.72); color:#fff; padding:.55rem .9rem; border-radius:10px; font-size:.7rem; z-index:29; display:none }
    #tapHint.show{ display:block }

    /* retro grid background for app */
    body::before{ content:""; position:fixed; inset:0; background-size:32px 32px; background-image: linear-gradient(to right, rgba(0,0,0,.15) 1px, transparent 1px), linear-gradient(to bottom, rgba(0,0,0,.15) 1px, transparent 1px); pointer-events:none; z-index:0; }
    main{ position:relative; padding: 0 1rem 2.4rem; max-width:1000px; margin:0 auto; z-index:1 }

    .tabs{ display:flex; gap:.5rem; flex-wrap:wrap; margin:1rem 0; justify-content:center }
    .tabs button{ background:#e9f6ff; color:#174260; border:none; padding:.6rem .8rem; border-radius:10px; cursor:pointer; box-shadow:0 4px 0 #badcf4 }
    .tabs button[aria-selected="true"]{ background:#ffe7c9; color:#50381d; box-shadow:0 4px 0 #d7b38a }

    .card{ background:var(--card); border-radius:12px; border:4px solid #e8dcc6; box-shadow:0 12px 24px var(--shadow) }
    .day{ margin:1rem 0; padding:.9rem }
    .entry{ display:grid; grid-template-columns:1fr auto; gap:.6rem; border:1px dashed #ead9ba; border-radius:10px; padding:.7rem; margin:.6rem 0 }
    .entry .meta{ color:#7c6b55; font-size:.9rem }
    .entry a{ color:#0b66b2; text-decoration:none }

    .widgets{ display:grid; grid-template-columns:1fr; gap:1rem }
    .widget{ padding:1rem }
    @media(min-width:720px){ .widgets{ grid-template-columns:repeat(3,1fr) } }

    footer .bar{ display:flex; justify-content:flex-end; align-items:center; gap:1rem; padding:0 1rem 2rem; max-width:1000px; margin:0 auto }
    #confetti{ position:fixed; inset:0; pointer-events:none; z-index:10 }

    /* Yorknew City BG for hype scene */
    #scene2{ background:url('yorknew1.png') center/cover no-repeat; }
    #scene2 .modal{ background:rgba(255,255,255,0.85); }
  </style>
</head>
<body>
  <header class="hero">
    <h1>yorknew city story route</h1>
    <p class="sub">trip starts in <span id="countdown">‚Äî</span></p>
  </header>

  <section id="scene1" class="scene active">
    <div class="modal">
      <h2>hello bb! üéâ</h2>
      <p id="bd-line" style="font-size:.8rem">It is your birthday in <strong id="bd-count">‚Äî</strong>, and you know what that means‚Ä¶</p>
      <div class="row">
        <button id="btn-what" class="btn">what does it mean?!?</button>
        <button id="btn-know" class="btn secondary">i know what that means :D</button>
      </div>
    </div>
  </section>

  <section id="scene2" class="scene">
    <div class="modal">
      <h2 style="font-size:clamp(1.6rem,5vw,2.6rem); margin:.2rem 0 .4rem">YORKNEW CITY RAHHHHHüóΩüí•</h2>
      <p style="font-size:.8rem; color:#5b4630">click anywhere to continue‚Ä¶</p>
    </div>
  </section>

  <div id="narrator" class="narrator-layer">
    <div id="speech" class="speech">
      <div class="txt"><span class="who">your girlfriend</span><div id="speechTxt">Loading‚Ä¶</div></div>
    </div>
  </div>

  <!-- Chibi floating above speech -->
  <div class="chibi-head" id="chibiHead" tabindex="0" aria-label="Chibi">
    <img id="chibiImg" src="gfchibi.png" alt="Chibi" />
  </div>

  <div id="tapHint">click anywhere to continue ‚Üí</div>

  <main id="app" hidden>
    <nav id="dayTabs" class="tabs" role="tablist" aria-label="Itinerary days"></nav>
    <section id="days"></section>
    <section class="widgets">
      <article class="widget card">
        <h3>üéµ Vinyl Picker</h3>
        <p>Spin to pick tonight's vinyl at the lounge.</p>
        <button id="vinylBtn" class="btn">Spin</button>
        <div id="vinylResult" class="result" style="margin-top:.5rem"></div>
      </article>
      <article class="widget card">
        <h3>üçï Secret Treat</h3>
        <p>Click to reveal your post-dinner treat.</p>
        <button id="treatBtn" class="btn">Reveal</button>
        <div id="treatResult" class="result" style="margin-top:.5rem"></div>
      </article>
      <article class="widget card">
        <h3>üíå Little Notes</h3>
        <textarea id="noteArea" placeholder="Leave a sweet note here‚Ä¶" style="width:100%;min-height:96px;border:2px dashed #ead9ba;border-radius:10px;padding:.6rem .8rem"></textarea>
        <button id="saveNote" class="btn" style="margin-top:.5rem">Save</button>
        <small id="noteSaved" role="status" style="font-size:.7rem"></small>
      </article>
    </section>
  </main>

  <footer>
    <div class="bar">
      <a id="exportJSON" download="itinerary.json" href="#">Export plan JSON</a>
    </div>
  </footer>

  <canvas id="confetti" aria-hidden="true"></canvas>

  <script>
    const trip={ startDate:"2025-10-02", birthday:"2025-10-03", days:[
      {label:"Day 1 ¬∑ Thu", date:"2025-10-02", items:[{time:"Afternoon", title:"Check-in & Coffee"}]},
      {label:"Day 2 ¬∑ Fri ¬∑ üéÇ Birthday", date:"2025-10-03", items:[{time:"Dinner", title:"Omakase ‚Üí Pizza & Vinyl"}]},
    ], vinylChoices:["Kind of Blue","Abbey Road"], treats:["Joe‚Äôs slice üçï","Levain cookie üç™"] };

    const $=(q,root=document)=>root.querySelector(q);
    const countdownEl=$('#countdown'); const bdCount=$('#bd-count');
    const scene1=$('#scene1'), scene2=$('#scene2');
    const btnWhat=$('#btn-what'), btnKnow=$('#btn-know');
    const narrator=$('#narrator'); const speechTxt=$('#speechTxt'); const tapHint=$('#tapHint');
    const app=$('#app'); const dayTabs=$('#dayTabs'); const daysWrap=$('#days');
    const vinylBtn=$('#vinylBtn'), vinylResult=$('#vinylResult'); const treatBtn=$('#treatBtn'), treatResult=$('#treatResult');
    const noteArea=$('#noteArea'), saveNote=$('#saveNote'), noteSaved=$('#noteSaved'); const exportJSON=$('#exportJSON');

    function fmtTwo(n){return String(n).padStart(2,'0')}
    function humanCountdown(to){ const now=new Date(); const t=new Date(to); let ms=t-now; if(ms<0) ms=0; const d=Math.floor(ms/86400000); ms%=86400000; const h=Math.floor(ms/3600000); ms%=3600000; const m=Math.floor(ms/60000); ms%=60000; const s=Math.floor(ms/1000); return `${d}d ${fmtTwo(h)}h:${fmtTwo(m)}m:${fmtTwo(s)}s`; }
    function daysUntil(start){ const t=new Date(start+"T00:00:00"); const now=new Date(); const d=Math.ceil((t-now)/86400000); return d>=0?`${d} day${d===1?'':'s'}`:`${Math.abs(d)} day${Math.abs(d)===1?'':'s'} ago`; }
    function tickCountdown(){ countdownEl.textContent=daysUntil(trip.startDate); bdCount.textContent=humanCountdown(`${trip.birthday}T00:00:00`); }
    tickCountdown(); setInterval(tickCountdown,1000);

    const lines=[
      "‚Ä¶what will we be doing in NYC, you may ask?",
      "Well, I coded a tiny retro adventure to reveal our plan.",
      "Follow me! We'll open the itinerary together."
    ];
    let li=-1; let isTyping=false;

    function showScene2(){ scene1.classList.remove('active'); scene2.classList.add('active'); confetti(160); }
    function exitScene2(e){ if(e) e.stopPropagation(); scene2.classList.remove('active'); setTimeout(startNarration,0); }
    btnWhat.addEventListener('click',showScene2);
    btnKnow.addEventListener('click',showScene2);
    scene2.addEventListener('click',exitScene2);

    async function startNarration(){ try{ if(document.fonts&&document.fonts.ready) await document.fonts.ready; }catch{} narrator.classList.add('show'); say(lines[++li]); }

    function typeText(el,text,cb){ if(isTyping) return; isTyping=true; el.classList.add('typing'); el.textContent=''; let i=0; const step=()=>{ el.textContent+=(text[i++]||''); if(i<=text.length){ requestAnimationFrame(step); } else { el.classList.remove('typing'); isTyping=false; cb&&cb(); } }; requestAnimationFrame(step); }
    function say(text){ typeText(speechTxt,text,()=>tapHint.classList.add('show')); }

    document.addEventListener('click',()=>{ if(!narrator.classList.contains('show')) return; if(isTyping) return; tapHint.classList.remove('show'); li++; if(li<lines.length){ say(lines[li]); } else { narrator.classList.remove('show'); openApp(); } });

    function openApp(){ app.hidden=false; renderDays(); confetti(120); }

    function renderDays(){ dayTabs.innerHTML=''; trip.days.forEach((d,i)=>{ const b=document.createElement('button'); b.textContent=d.label; b.setAttribute('role','tab'); b.setAttribute('aria-selected',i===0?'true':'false'); b.addEventListener('click',()=>{ document.querySelectorAll('.tabs button').forEach(el=>el.setAttribute('aria-selected','false')); b.setAttribute('aria-selected','true'); renderDay(i); }); dayTabs.appendChild(b); }); renderDay(0); }
    function renderDay(i){ const d=trip.days[i]; const wrap=document.createElement('section'); wrap.className='card day'; wrap.innerHTML=`<h3>${d.label} ${d.date}</h3>`; d.items.forEach(it=>{ wrap.innerHTML+=`<p><strong>${it.time}</strong> ‚Äî ${it.title}</p>`; }); daysWrap.innerHTML=''; daysWrap.appendChild(wrap); }

    vinylBtn.addEventListener('click',()=>{ const pick=trip.vinylChoices[Math.floor(Math.random()*trip.vinylChoices.length)]; vinylResult.textContent="Tonight's pick: "+pick; confetti(60); });
    treatBtn.addEventListener('click',()=>{ const pick=trip.treats[Math.floor(Math.random()*trip.treats.length)]; treatResult.textContent="Surprise: "+pick; confetti(60); });

    const NOTE_KEY='nyc_itin_note'; noteArea.value=localStorage.getItem(NOTE_KEY)||''; saveNote.addEventListener('click',()=>{ localStorage.setItem(NOTE_KEY,noteArea.value); noteSaved.textContent='Saved ‚úì'; setTimeout(()=>
