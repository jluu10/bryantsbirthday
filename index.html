<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>yorknew city birthday route</title>
  <!-- Use display=block to avoid mid-render font swapping -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=block" rel="stylesheet">
  <style>
    :root{
      --sky:#aee3ff; --sky-2:#86d7ff; --sand:#f5e9d2;
      --ink:#111827; --muted:#6b7280; --card:#fffdf8; --accent:#4aa3ff; --accent-2:#ffbf7f;
      --ring:rgba(74,163,255,.45); --shadow:rgba(0,0,0,.12);
      --chibi-size:84px; /* 72‚Äì96px recommended */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:linear-gradient(180deg,var(--sky) 0%,var(--sky-2) 50%,var(--sand) 100%); color:var(--ink); font-family:'Press Start 2P', ui-monospace, Menlo, Consolas, monospace}

    header.hero{ text-align:center; padding:1.25rem .8rem .4rem }
    header.hero h1{ margin:.2rem 0; font-size:clamp(1.1rem,2.6vw,1.6rem) }
    header.hero .sub{ color:#233; opacity:.9; font-size:.8rem }

    .scene{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; padding:1rem; z-index:30 }
    .scene.active{ display:flex }
    .modal{ width:min(740px,100%); background:var(--card); border:4px solid #e8dcc6; border-radius:12px; padding:1rem; box-shadow:0 20px 60px var(--shadow); text-align:center }
    .row{ display:flex; flex-wrap:wrap; gap:.6rem; margin-top:.6rem; justify-content:center }
    .btn{ background:var(--accent); color:#fff; border:none; padding:.75rem 1rem; border-radius:10px; box-shadow:0 6px 0 #2b79c5; cursor:pointer }
    .btn.secondary{ background:#ffe7c9; color:#50381d; box-shadow:0 6px 0 #d7b38a }
    .btn:focus{ outline:2px solid var(--ring); outline-offset:2px }

    /* narrator: center without using transform (prevents Safari text scramble) */
    .narrator-layer{ position:fixed; inset:0; z-index:28; display:none }
    .narrator-layer.show{ display:grid; place-items:center }

    .speech{ position:relative; margin:0 auto;
      display:flex; align-items:center; gap:14px; flex-wrap:nowrap; overflow:hidden;
      background:var(--card); border:4px solid #e8dcc6; border-radius:12px; padding:1rem 1.1rem;
      width:min(780px,92vw); min-height: calc(var(--chibi-size) + 24px); box-shadow:0 20px 60px var(--shadow);
      backface-visibility: hidden; will-change: contents;
    }
    .speech .txt{ line-height:1.6; font-size:.8rem; flex:1;
      font-variant-ligatures:none; font-feature-settings:"liga" 0, "kern" 0, "clig" 0, "calt" 0; font-kerning:none;
      text-align:left; -webkit-font-smoothing:antialiased; text-rendering:geometricPrecision; contain: content;
    }
    .speech .who{ display:block; color:#7c6b55; font-size:.7rem; margin-bottom:.25rem;
      font-variant-ligatures:none; font-feature-settings:"liga" 0, "kern" 0; font-kerning:none;
    }

    /* chibi (no mini bubble) */
    .chibi-head{ --size:var(--chibi-size); flex:0 0 var(--chibi-size);
      position:relative; width:var(--size); height:var(--size); user-select:none; touch-action:none;
      filter:drop-shadow(0 8px 14px rgba(0,0,0,.25)); animation:bob 2.1s ease-in-out infinite; will-change: transform; }
    .chibi-head img {width:100%; height:auto; display:block; object-fit:contain; image-rendering:pixelated; transform-origin:50% 90%; }
    .chibi-head.wave img{ animation:wave 900ms ease-in-out 1; }
    @keyframes bob{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
    @keyframes wave{0%{ rotate:0 }25%{ rotate:-6deg }60%{ rotate:4deg }100%{ rotate:0 }}

    /* click-anywhere hint */
    #tapHint{ position:fixed; bottom:18px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,.72); color:#fff; padding:.55rem .9rem; border-radius:10px; font-size:.7rem; z-index:29; display:none }
    #tapHint.show{ display:block }

    /* retro grid background for app */
    body::before{ content:""; position:fixed; inset:0; background-size:32px 32px; background-image: linear-gradient(to right, rgba(0,0,0,.15) 1px, transparent 1px), linear-gradient(to bottom, rgba(0,0,0,.15) 1px, transparent 1px); pointer-events:none; z-index:0; }

    main{ position:relative; padding: 0 1rem 2.4rem; max-width:1000px; margin:0 auto; z-index:1 }
    .tabs{ display:flex; gap:.5rem; flex-wrap:wrap; margin:1rem 0; justify-content:center }
    .tabs button{ background:#e9f6ff; color:#174260; border:none; padding:.6rem .8rem; border-radius:10px; cursor:pointer; box-shadow:0 4px 0 #badcf4 }
    .tabs button[aria-selected="true"]{ background:#ffe7c9; color:#50381d; box-shadow:0 4px 0 #d7b38a }
    .card{ background:var(--card); border-radius:12px; border:4px solid #e8dcc6; box-shadow:0 12px 24px var(--shadow) }
    .day{ margin:1rem 0; padding:.9rem }
    .entry{ display:grid; grid-template-columns:1fr auto; gap:.6rem; border:1px dashed #ead9ba; border-radius:10px; padding:.7rem; margin:.6rem 0 }
    .entry .meta{ color:#7c6b55; font-size:.9rem }
    .entry a{ color:#0b66b2; text-decoration:none }
    .widgets{ display:grid; grid-template-columns:1fr; gap:1rem }
    .widget{ padding:1rem }
    @media(min-width:720px){ .widgets{ grid-template-columns:repeat(3,1fr) } }
    footer .bar{ display:flex; justify-content:space-between; align-items:center; gap:1rem; padding:0 1rem 2rem; max-width:1000px; margin:0 auto }
    #confetti{ position:fixed; inset:0; pointer-events:none; z-index:10 }

    /* Yorknew City BG for hype scene */
    #scene2{ background:url('yorknew1.png') center/cover no-repeat; }
    #scene2 .modal{ background:rgba(255,255,255,0.85); }

    /* responsive chibi sizing */
    @media (max-width: 600px){ :root{ --chibi-size:72px; } }
    @media (min-width: 1200px){ :root{ --chibi-size:96px; } }
  </style>
</head>
<body>
  <header class="hero">
    <h1>yorknew city story route</h1>
    <p class="sub">trip starts in <span id="countdown">‚Äî</span></p>
  </header>

  <section id="scene1" class="scene active">
    <div class="modal">
      <h2>hello bb! üéâ</h2>
      <p id="bd-line" style="font-size:.8rem">It is your birthday in <strong id="bd-count">‚Äî</strong>, and you know what that means‚Ä¶</p>
      <div class="row">
        <button id="btn-what" class="btn">what does it mean?!?</button>
        <button id="btn-know" class="btn secondary">i know what that means :D</button>
      </div>
    </div>
  </section>

  <section id="scene2" class="scene">
    <div class="modal">
      <h2 style="font-size:clamp(1.6rem,5vw,2.6rem); margin:.2rem 0 .4rem">YORKNEW CITY RAHHHHHüóΩüí•</h2>
      <p style="font-size:.8rem; color:#5b4630">click anywhere to continue‚Ä¶</p>
    </div>
  </section>

  <div id="narrator" class="narrator-layer">
    <div id="speech" class="speech">
      <div class="chibi-head" id="chibiHead" tabindex="0" aria-label="Chibi">
        <img id="chibiImg" src="gfchibi.png" alt="Chibi" />
      </div>
      <div class="txt"><span class="who">your girlfriend</span><div id="speechTxt">Loading‚Ä¶</div></div>
    </div>
  </div>

  <div id="tapHint">click anywhere to continue ‚Üí</div>

  <main id="app" hidden>
    <nav id="dayTabs" class="tabs" role="tablist" aria-label="Itinerary days"></nav>
    <section id="days"></section>
    <section class="widgets">
      <article class="widget card">
        <h3>üéµ Vinyl Picker</h3>
        <p>Spin to pick tonight's vinyl at the lounge.</p>
        <button id="vinylBtn" class="btn">Spin</button>
        <div id="vinylResult" class="result" style="margin-top:.5rem"></div>
      </article>
      <article class="widget card">
        <h3>üçï Secret Treat</h3>
        <p>Click to reveal your post-dinner treat.</p>
        <button id="treatBtn" class="btn">Reveal</button>
        <div id="treatResult" class="result" style="margin-top:.5rem"></div>
      </article>
      <article class="widget card">
        <h3>üíå Little Notes</h3>
        <textarea id="noteArea" placeholder="Leave a sweet note here‚Ä¶" style="width:100%;min-height:96px;border:2px dashed #ead9ba;border-radius:10px;padding:.6rem .8rem"></textarea>
        <button id="saveNote" class="btn" style="margin-top:.5rem">Save</button>
        <small id="noteSaved" role="status" style="font-size:.7rem"></small>
      </article>
    </section>
  </main>

  <footer>
    <div class="bar">
      <button id="shareBtn" class="btn">Share / Save</button>
      <a id="exportJSON" download="itinerary.json" href="#">Export plan JSON</a>
    </div>
  </footer>

  <canvas id="confetti" aria-hidden="true"></canvas>

  <script>
    /* ===== Trip Data ===== */
    const trip = {
      couple: { planner: "Jades", partner: "Bryant" },
      startDate: "2025-10-02",
      birthday:  "2025-10-06",
      days: [
        { label: "Day 1 ¬∑ Thu", date: "2025-10-02", items:[
          { time:"Afternoon", title:"Check-in & Coffee", desc:"Drop bags, stroll to a cozy caf√© near the hotel.", link:"https://maps.apple.com/", notes:"Option: Canal St Market bites."},
          { time:"Evening", title:"Warm-up jazz set (soft option)", desc:"Live jazz vibes; keep it flexible if travel tired.", link:"#" }
        ]},
        { label: "Day 2 ¬∑ Fri ¬∑ üéÇ Birthday", date: "2025-10-03", items:[
          { time:"Morning", title:"Slow morning walk", desc:"Stroll a park or waterfront boardwalk.", link:"#" },
          { time:"Dinner", title:"Omakase ‚Üí Pizza & Vinyl", desc:"Chef‚Äôs counter; after, a slice and pick a vinyl at a lounge.", link:"#", notes:"Bring ID for vinyl bar."},
          { time:"Late", title:"Rooftop Nightcap", desc:"City lights & photos.", link:"#" }
        ]},
        { label: "Day 3 ¬∑ Sat", date: "2025-10-04", items:[
          { time:"Daytime", title:"Neighborhood Stroll & Thrift Pop-up", desc:"Williamsburg or LES walk; vintage browse.", link:"#" },
          { time:"Evening", title:"Showtime", desc:"Pick a concert/comedy based on mood.", link:"#" }
        ]},
        { label: "Day 4 ¬∑ Sun", date: "2025-10-05", items:[
          { time:"Morning", title:"Museum or Gallery Hop", desc:"Choose 1‚Äì2 spots and keep it light.", link:"#" },
          { time:"Evening", title:"Sunset Walk & Dessert", desc:"Pier photos + sweet treat.", link:"#" }
        ]},
        { label: "Day 5 ¬∑ Mon", date: "2025-10-06", items:[
          { time:"Morning", title:"Bonus Day", desc:"One more NYC stroll, coffee & park.", link:"#" },
          { time:"Afternoon", title:"Last bites & souvenirs", desc:"Pick up gifts and head to airport.", link:"#" }
        ]}
      ],
      vinylChoices: ["Kind of Blue","Abbey Road","Blonde","Random vinyl","Blue Train","Frank at the Sands"],
      treats: ["Joe‚Äôs slice üçï","Levain cookie üç™","Soft-serve üç¶","Arthur Avenue cannoli ü•ê"]
    };

    /* ===== Helpers ===== */
    const $ = (q,root=document)=>root.querySelector(q);
    const $$ = (q,root=document)=>[...root.querySelectorAll(q)];

    const countdownEl = $('#countdown');
    const scene1=$('#scene1'), scene2=$('#scene2');
    const bdCount=$('#bd-count');
    const btnWhat=$('#btn-what'), btnKnow=$('#btn-know');
    const narrator=$('#narrator');
    const speechTxt=$('#speechTxt');
    const tapHint=$('#tapHint');

    const app=$('#app');
    const dayTabs=$('#dayTabs');
    const daysWrap=$('#days');

    const vinylBtn=$('#vinylBtn'), vinylResult=$('#vinylResult');
    const treatBtn=$('#treatBtn'), treatResult=$('#treatResult');
    const noteArea=$('#noteArea'), saveNote=$('#saveNote'), noteSaved=$('#noteSaved');
    const shareBtn=$('#shareBtn'), exportJSON=$('#exportJSON');

    /* ===== Countdown ===== */
    function fmtTwo(n){return String(n).padStart(2,'0')}
    function humanCountdown(to){ const now=new Date(); const t=new Date(to); let ms=t-now; if(ms<0) ms=0; const d=Math.floor(ms/86400000); ms%=86400000; const h=Math.floor(ms/3600000); ms%=3600000; const m=Math.floor(ms/60000); ms%=60000; const s=Math.floor(ms/1000); return `${d}d ${fmtTwo(h)}h:${fmtTwo(m)}m:${fmtTwo(s)}s`; }
    function daysUntil(start){ const t=new Date(start+"T00:00:00"); const now=new Date(); const d=Math.ceil((t-now)/86400000); return d>=0?`${d} day${d===1?'':'s'}`:`${Math.abs(d)} day${Math.abs(d)===1?'':'s'} ago`; }
    function tickCountdown(){ countdownEl.textContent = daysUntil(trip.startDate); bdCount.textContent = humanCountdown(`${trip.birthday}T00:00:00`); }
    tickCountdown(); setInterval(tickCountdown,1000);

    /* ===== Story flow ===== */
    const lines=[
      "‚Ä¶what will we be doing in NYC, you may ask?",
      "Well, I coded a tiny retro adventure to reveal our plan.",
      "Follow me! We'll open the itinerary together."
    ];
    let li=-1;

    function showScene2(){ scene1.classList.remove('active'); scene2.classList.add('active'); confetti(160); }
    function exitScene2(){ scene2.classList.remove('active'); startNarration(); }
    btnWhat.addEventListener('click', showScene2);
    btnKnow.addEventListener('click', showScene2);
    scene2.addEventListener('click', exitScene2);

    async function startNarration(){
      // Wait for font to fully load to avoid Safari/Chrome reflow glitches during typewriter
      try{ if(document.fonts && document.fonts.ready) await document.fonts.ready; }catch{}
      narrator.classList.add('show'); say(lines[++li]);
    }
    function typeText(el, text, cb){ el.textContent=''; let i=0; const t=setInterval(()=>{ el.textContent+=(text[i++]||''); if(i>=text.length){ clearInterval(t); cb&&cb(); } },18); }
    function say(text){ typeText(speechTxt, text, ()=> tapHint.classList.add('show')); }

    // Click ANYWHERE to continue when narrator is visible
    document.addEventListener('click', (e)=>{
      if(!narrator.classList.contains('show')) return; // ignore when narrator hidden
      tapHint.classList.remove('show');
      li++;
      if(li < lines.length){ say(lines[li]); }
      else { narrator.classList.remove('show'); openApp(); }
    });

    function openApp(){ app.hidden=false; renderDays(); confetti(120); }

    /* ===== Itinerary ===== */
    function renderDays(){
      dayTabs.innerHTML='';
      trip.days.forEach((d,i)=>{
        const b=document.createElement('button');
        b.textContent=d.label; b.setAttribute('role','tab'); b.setAttribute('aria-selected', i===0?'true':'false');
        b.addEventListener('click',()=>{ $$('.tabs button').forEach(el=>el.setAttribute('aria-selected','false')); b.setAttribute('aria-selected','true'); renderDay(i); });
        dayTabs.appendChild(b);
      });
      renderDay(0);
    }
    function renderDay(i){
      const d=trip.days[i];
      const wrap=document.createElement('section'); wrap.className='card day';
      wrap.innerHTML=`<h3 style="margin:.2rem 0 .4rem">${d.label} <span style="font-weight:400;color:#7c6b55">${d.date}</span></h3>`;
      d.items.forEach(item=>{
        const e=document.createElement('article'); e.className='entry';
        e.innerHTML=`<div><div style=\"font-size:.8rem\">${item.title}</div><div class=\"meta\">${item.time}</div><p>${item.desc||''}${item.notes? ' ‚Äî <em>'+item.notes+'</em>':''}</p></div><div>${item.link? `<a href=\"${item.link}\" target=\"_blank\" rel=\"noopener\">Open map/site ‚Üó</a>`:''}</div>`;
        wrap.appendChild(e);
      });
      daysWrap.innerHTML=''; daysWrap.appendChild(wrap);
    }

    // Widgets
    vinylBtn.addEventListener('click',()=>{ const pick=trip.vinylChoices[Math.floor(Math.random()*trip.vinylChoices.length)]; vinylResult.textContent = "Tonight's pick: "+pick; confetti(60); });
    treatBtn.addEventListener('click',()=>{ const pick=trip.treats[Math.floor(Math.random()*trip.treats.length)]; treatResult.textContent = "Surprise: "+pick; confetti(60); });

    // Notes
    const NOTE_KEY='nyc_itin_note'; noteArea.value=localStorage.getItem(NOTE_KEY)||''; saveNote.addEventListener('click',()=>{ localStorage.setItem(NOTE_KEY, noteArea.value); noteSaved.textContent='Saved ‚úì'; setTimeout(()=>noteSaved.textContent='',1200); });

    // Share/export
    shareBtn.addEventListener('click', async ()=>{ const data={title:'NYC Birthday Adventure', text:'Peek at our surprise itinerary üí´', url:location.href}; if(navigator.share){ try{ await navigator.share(data);}catch{} } else { await navigator.clipboard.writeText(location.href); alert('Link copied!'); } });
    exportJSON.addEventListener('click',()=>{ const blob=new Blob([JSON.stringify(trip,null,2)],{type:'application/json'}); exportJSON.href=URL.createObjectURL(blob); });

    /* ===== Confetti ===== */
    const cvs=document.getElementById('confetti'); const ctx=cvs.getContext('2d'); let pf=[];
    function size(){ cvs.width=innerWidth; cvs.height=innerHeight } window.addEventListener('resize',size); size();
    function confetti(N=100){ const colors=['#4aa3ff','#86d7ff','#ffbf7f','#f5e9d2','#ffffff']; for(let i=0;i<N;i++){ pf.push({x:innerWidth/2,y:80,vx:(Math.random()*2-1)*4,vy:-(2+Math.random()*3),g:.06+Math.random()*.04,s:2+Math.random()*3,c:colors[(Math.random()*colors.length)|0],t:100+Math.random()*80}); } }
    (function tick(){ ctx.clearRect(0,0,cvs.width,cvs.height); pf.forEach(p=>{ p.t--; p.vy+=p.g; p.x+=p.vx; p.y+=p.vy; ctx.fillStyle=p.c; ctx.fillRect(p.x,p.y,p.s,p.s) }); pf=pf.filter(p=>p.t>0&&p.y<cvs.height+16); requestAnimationFrame(tick) })();
  </script>
</body>
</html>
